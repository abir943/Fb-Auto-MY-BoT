const cron = require('node-cron');

/**
 * Schedule greeting messages for all threads.
 * 
 * @param {string} ownerID - The ID of the bot owner.
 * @param {object} api - The Facebook Chat API instance.
 * @param {object} config - Configuration options (currently supports autoGreet).
 */
const scheduleTasks = (ownerID, api, config = { autoGreet: true }) => {
    console.log("âœ… Scheduler initialized (Auto-restart removed).");

    if (config.autoGreet) {
        const messages = {
            "0 0 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 12:00 ğ—”ğŒ â³\n\n à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§§à§¨à¦Ÿà¦¾ à¦¬à§‡à¦œà§‡ à¦—à§‡à¦²à§‹ à¦¸à¦¬à¦¾à¦‡ à¦¶à§à§Ÿà§‡ à¦ªà§œà§‹ ğŸ¥€\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 1 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 1:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦ªà§à¦°à§‡à¦® à¦¨à¦¾ à¦•à¦‡à¦°à¦¾ à¦¯à¦¾à¦‡à§Ÿà¦¾ à¦˜à§à¦®à¦¾ à¦¬à§‡à¦•à§à¦•à¦²ğŸ˜˜\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 2 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 2:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§¨à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¯à¦¾à¦°à¦¾ à¦›à§à¦¯à¦¾à¦•à¦¾ à¦–à¦¾à¦‡à¦›à§‡ à¦¤à¦¾à¦°à¦¾ à¦œà§‡à¦—à§‡ à¦†à¦›à§‡ ğŸ˜³\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 3 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 3:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§©à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¸à¦¬à¦¾à¦‡ à¦®à¦¨à§‡ à¦¹à§Ÿ à¦˜à§à¦®ğŸ¥¹ à¦†à¦®à¦¾à¦° à¦­à¦¾à¦‡ à¦˜à§à¦® à¦†à¦¸à§‡ à¦¨à¦¾ğŸŒƒ \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 4 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 4:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§ªà¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦à¦•à¦Ÿà§ à¦ªà¦° à¦«à¦œà¦°à§‡à¦° à¦†à¦¯à¦¾à¦¨ à¦¦à¦¿à¦²à§‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà§‡ à¦¨à¦¿à¦“ à¦¸à¦¬à¦¾à¦‡ ğŸŒƒ \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 5 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 5:00 ğ—”ğŒ â³\n\n à¦à¦–à¦¨ à¦­à§‹à¦° à§«à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà¦›à§‹ à¦¤à§‹?â¤ï¸ \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 6 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 6:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦•à¦¾à¦² à§¬à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦˜à§à¦® à¦¥à§‡à¦•à§‡ à¦‰à¦ à§‹ à¦¸à¦¬à¦¾à¦‡â¤ï¸ğŸ¥€ ğŸ’– \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 7 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 7:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦•à¦¾à¦² à§­à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¸à¦¬à¦¾à¦‡ à¦¬à§à¦°à§‡à¦•à¦«à¦¾à¦¸à§à¦Ÿ à¦•à¦°à§‡ à¦¨à¦¾à¦“ğŸ¥° \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 8 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€ \n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 8:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦•à¦¾à¦² à§® à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¸à¦¬à¦¾à¦‡ à¦®à¦¨à§‡ à¦¹à§Ÿ à¦•à¦¾à¦œà§‡ à¦¬à§à¦¯à¦¸à§à¦¤ à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‹ğŸ˜µ \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 9 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 9:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦•à¦¾à¦² à§¯ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦®à¦¨ à¦¦à¦¿à§Ÿà§‡ à¦•à¦¾à¦œ à¦•à¦°à§‹ à¦¸à¦¬à¦¾à¦‡â¤ï¸ğŸ™ˆ \nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 10 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 10:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦•à¦¾à¦² à§§à§¦à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦®à¦¿à¦¸ à¦•à¦°à¦›à¦¿ à¦¤à§‹à¦®à¦¾à¦¦à§‡à¦°ğŸ™€\nâ”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 11 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 11:00 AğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦•à¦¾à¦² à§§à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ğŸ˜»\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 12 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 12:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¦à§à¦ªà§à¦° à§§à§¨à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ â¤ï¸ğŸ¥µ\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 13 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 1:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¦à§à¦ªà§à¦° à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¸à¦¬à¦¾à¦‡ à¦•à¦¾à¦œ à¦¬à¦¨à§à¦§ à¦•à¦°à§‡ à¦œà§‹à¦¹à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà§‡ à¦¨à¦¾à¦“ğŸ˜»ğŸ˜‡ \n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€ ğŸš¶",
            "0 14 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 2:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¦à§à¦ªà§à¦° à§¨à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦—à§‹à¦¸à¦² à¦•à¦°à§‡ à¦¸à¦¬à¦¾à¦‡ à¦¦à§à¦ªà§à¦°à§‡à¦° à¦–à¦¾à¦¬à¦¾à¦° à¦–à§‡à§Ÿà§‡ à¦¨à¦¾à¦“ ğŸ’–ğŸ˜‡\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 15 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 3:00 ğğŒ â³\n\n ~à¦à¦–à¦¨ à¦¦à§à¦ªà§à¦° à§©à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ğŸ˜˜\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 16 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 4:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¬à¦¿à¦•à¦¾à¦² à§ªà¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦†à¦¸à¦°à§‡à¦° à¦†à¦¯à¦¾à¦¨ à¦¦à¦¿à¦²à§‡ à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà§‡ à¦¨à¦¾à¦“ğŸ¥µ\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 17 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 5:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¬à¦¿à¦•à¦¾à¦² à§«à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦à¦•à¦Ÿà§ à¦ªà¦° à¦®à¦¾à¦—à¦°à¦¿à¦¬à§‡à¦° à¦†à¦¯à¦¾à¦¨ à¦¦à¦¿à¦¬à§‡ à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà§‡ à¦¨à¦¿à¦“ ğŸ˜»ğŸ˜‡\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 18 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 6:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à§¬à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦¸à¦¬à¦¾à¦‡ à¦¹à¦¾à¦¤à¦®à§à¦– à¦§à§à§Ÿà§‡ à¦•à¦¿à¦›à§ à¦–à§‡à§Ÿà§‡ à¦¨à¦¾à¦“ à¦à¦¬à¦‚ à¦ªà¦°à¦¿à¦¬à¦¾à¦°à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦¸à¦®à§Ÿ à¦•à¦¾à¦Ÿà¦¾à¦“ ğŸ’–\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 19 * * *": "â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€\n ğğ¨ğ° ğ¢ğ­ğ¬ ğ­ğ¢ğ¦ğ 7:00 ğğŒ â³\n\n à¦à¦–à¦¨ à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à§­ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡ à¦•à¦¿ à¦•à¦°à¦›à§‡à¦¾ à¦¸à¦¬à¦¾à¦‡ à¦à¦–à¦¨ à¦à¦¶à¦¾à¦° à¦†à¦¯à¦¾à¦¨ à¦¦à¦¿à¦¬à§‡ à¦¸à¦¬à¦¾à¦‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà§œà§‡ à¦¨à¦¾à¦“ğŸ’\n â”€â”€â”€â”€ â€¢ğŸ’œâ€¢ â”€â”€â”€â”€",
            "0 20 * * *": "ğŸŒ† à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à¦¹à§Ÿà§‡ à¦—à§‡à¦›à§‡! à¦†à¦œà¦•à§‡à¦° à¦¦à¦¿à¦¨ à¦•à§‡à¦®à¦¨ à¦•à¦¾à¦Ÿà¦²à§‹?",
            "0 21 * * *": "ğŸŒ™ à¦à¦–à¦¨ à¦°à¦¾à¦¤ à§¯à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡! à¦§à§€à¦°à§‡ à¦§à§€à¦°à§‡ à¦¬à¦¿à¦¶à§à¦°à¦¾à¦®à§‡à¦° à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à¦¾à¦“ ğŸ’«",
            "0 22 * * *": "ğŸŒŒ à¦°à¦¾à¦¤ à§§à§¦à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡, à¦˜à§à¦®à¦¾à¦¨à§‹à¦° à¦†à¦—à§‡ à¦ªà§à¦°à¦¿à§Ÿà¦œà¦¨à¦¦à§‡à¦° à¦®à§‡à¦¸à§‡à¦œ à¦¦à¦¾à¦“ â¤ï¸",
            "0 23 * * *": "ğŸŒƒ à¦°à¦¾à¦¤ à§§à§§à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡! à¦¶à§à§Ÿà§‡ à¦ªà§œà§‹, à¦•à¦¾à¦² à¦¨à¦¤à§à¦¨ à¦¦à¦¿à¦¨ âœ¨"
        };

        Object.entries(messages).forEach(([time, message]) => {
            cron.schedule(time, () => {
                api.getThreadList(10, null, ["INBOX"], (err, threads) => {
                    if (err) {
                        console.error("âŒ Error fetching thread list:", err);
                        return;
                    }

                    threads.forEach(thread => {
                        api.sendMessage(message, thread.threadID, (err) => {
                            if (err) {
                                console.error(`âŒ Failed to send message to ${thread.threadID}:`, err);
                            }
                        });
                    });
                });

                console.log(`ğŸ“¢ Scheduled message sent at ${time}: "${message.split('\n')[0]}"`);
            }, { timezone: "Asia/Dhaka" });
        });

        console.log("âœ… Full hourly auto-greet messages scheduled.");
    } else {
        console.log("âŒ Auto-greet is disabled.");
    }
};

module.exports = scheduleTasks;
