const cron = require('node-cron');

/**
 * Schedule greeting messages for all threads.
 * 
 * @param {string} ownerID - The ID of the bot owner.
 * @param {object} api - The Facebook Chat API instance.
 * @param {object} config - Configuration options (currently supports autoGreet).
 */
const scheduleTasks = (ownerID, api, config = { autoGreet: true }) => {
    console.log("✅ Scheduler initialized (Auto-restart removed).");

    if (config.autoGreet) {
        const messages = {
            "0 0 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 12:00 𝗔𝐌 ⏳\n\n এখন রাত ১২টা বেজে গেলো সবাই শুয়ে পড়ো 🥀\n ──── •💜• ────",
            "0 1 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 1:00 A𝐌 ⏳\n\n এখন রাত ১টা বাজে প্রেম না কইরা যাইয়া ঘুমা বেক্কল😘\n ──── •💜• ────",
            "0 2 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 2:00 A𝐌 ⏳\n\n এখন রাত ২টা বাজে যারা ছ্যাকা খাইছে তারা জেগে আছে 😳\n ──── •💜• ────",
            "0 3 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 3:00 A𝐌 ⏳\n\n এখন রাত ৩টা বাজে সবাই মনে হয় ঘুম🥹 আমার ভাই ঘুম আসে না🌃 \n──── •💜• ────",
            "0 4 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 4:00 A𝐌 ⏳\n\n এখন রাত ৪টা বাজে একটু পর ফজরের আযান দিলে নামাজ পড়ে নিও সবাই 🌃 \n──── •💜• ────",
            "0 5 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 5:00 𝗔𝐌 ⏳\n\n এখন ভোর ৫টা বাজে সবাই নামাজ পড়ছো তো?❤️ \n──── •💜• ────",
            "0 6 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 6:00 A𝐌 ⏳\n\n এখন সকাল ৬টা বাজে ঘুম থেকে উঠো সবাই❤️🥀 💖 \n──── •💜• ────",
            "0 7 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 7:00 A𝐌 ⏳\n\n এখন সকাল ৭টা বাজে সবাই ব্রেকফাস্ট করে নাও🥰 \n──── •💜• ────",
            "0 8 * * *": "──── •💜• ──── \n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 8:00 A𝐌 ⏳\n\n এখন সকাল ৮ টা বাজে সবাই মনে হয় কাজে ব্যস্ত হয়ে গেছো😵 \n──── •💜• ────",
            "0 9 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 9:00 A𝐌 ⏳\n\n এখন সকাল ৯ টা বাজে মন দিয়ে কাজ করো সবাই❤️🙈 \n──── •💜• ────",
            "0 10 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 10:00 A𝐌 ⏳\n\n এখন সকাল ১০টা বাজে মিস করছি তোমাদের🙀\n──── •💜• ────",
            "0 11 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 11:00 A𝐌 ⏳\n\n এখন সকাল ১১টা বাজে😻\n ──── •💜• ────",
            "0 12 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 12:00 𝐏𝐌 ⏳\n\n এখন দুপুর ১২টা বাজে ❤️🥵\n ──── •💜• ────",
            "0 13 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 1:00 𝐏𝐌 ⏳\n\n এখন দুপুর ১টা বাজে সবাই কাজ বন্ধ করে জোহরের নামাজ পড়ে নাও😻😇 \n ──── •💜• ──── 🚶",
            "0 14 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 2:00 𝐏𝐌 ⏳\n\n এখন দুপুর ২টা বাজে গোসল করে সবাই দুপুরের খাবার খেয়ে নাও 💖😇\n ──── •💜• ────",
            "0 15 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 3:00 𝐏𝐌 ⏳\n\n ~এখন দুপুর ৩টা বাজে😘\n ──── •💜• ────",
            "0 16 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 4:00 𝐏𝐌 ⏳\n\n এখন বিকাল ৪টা বাজে আসরের আযান দিলে সবাই নামাজ পড়ে নাও🥵\n ──── •💜• ────",
            "0 17 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 5:00 𝐏𝐌 ⏳\n\n এখন বিকাল ৫টা বাজে একটু পর মাগরিবের আযান দিবে সবাই নামাজ পড়ে নিও 😻😇\n ──── •💜• ────",
            "0 18 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 6:00 𝐏𝐌 ⏳\n\n এখন সন্ধ্যা ৬টা বাজে সবাই হাতমুখ ধুয়ে কিছু খেয়ে নাও এবং পরিবারের সাথে সময় কাটাও 💖\n ──── •💜• ────",
            "0 19 * * *": "──── •💜• ────\n 𝐍𝐨𝐰 𝐢𝐭𝐬 𝐭𝐢𝐦𝐞 7:00 𝐏𝐌 ⏳\n\n এখন সন্ধ্যা ৭ টা বাজে কি করছো সবাই এখন এশার আযান দিবে সবাই নামাজ পড়ে নাও💞\n ──── •💜• ────",
            "0 20 * * *": "🌆 সন্ধ্যা হয়ে গেছে! আজকের দিন কেমন কাটলো?",
            "0 21 * * *": "🌙 এখন রাত ৯টা বাজে! ধীরে ধীরে বিশ্রামের প্রস্তুতি নাও 💫",
            "0 22 * * *": "🌌 রাত ১০টা বাজে, ঘুমানোর আগে প্রিয়জনদের মেসেজ দাও ❤️",
            "0 23 * * *": "🌃 রাত ১১টা বাজে! শুয়ে পড়ো, কাল নতুন দিন ✨"
        };

        Object.entries(messages).forEach(([time, message]) => {
            cron.schedule(time, () => {
                api.getThreadList(10, null, ["INBOX"], (err, threads) => {
                    if (err) {
                        console.error("❌ Error fetching thread list:", err);
                        return;
                    }

                    threads.forEach(thread => {
                        api.sendMessage(message, thread.threadID, (err) => {
                            if (err) {
                                console.error(`❌ Failed to send message to ${thread.threadID}:`, err);
                            }
                        });
                    });
                });

                console.log(`📢 Scheduled message sent at ${time}: "${message.split('\n')[0]}"`);
            }, { timezone: "Asia/Dhaka" });
        });

        console.log("✅ Full hourly auto-greet messages scheduled.");
    } else {
        console.log("❌ Auto-greet is disabled.");
    }
};

module.exports = scheduleTasks;
